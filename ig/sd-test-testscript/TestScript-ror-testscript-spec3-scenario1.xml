<?xml version="1.0" encoding="UTF-8"?>

<TestScript xmlns="http://hl7.org/fhir">
  <id value="ror-testscript-spec3-scenario1"/>
  <text>
    <status value="generated"/><div xmlns="http://www.w3.org/1999/xhtml"><p><b>Generated Narrative: TestScript</b><a name="ror-testscript-spec3-scenario1"> </a></p><div style="display: inline-block; background-color: #d9e0e7; padding: 6px; margin: 4px; border: 1px solid #8da1b4; border-radius: 5px; line-height: 60%"><p style="margin-bottom: 0px">Resource TestScript &quot;ror-testscript-spec3-scenario1&quot; </p></div><p><b>url</b>: <code>https://interop.esante.gouv.fr/ig/fhir/ror/StructureDefinition/ror-testscript-spec3-scenario1</code></p><p><b>version</b>: 0.2.0</p><p><b>name</b>: Recherche d'offre sur critères principaux : Scenario 1</p><p><b>title</b>: Recherche sur un critère en saisissant une valeur</p><p><b>status</b>: draft</p><p><b>experimental</b>: true</p><p><b>date</b>: 2024-01-13</p><p><b>publisher</b>: ANS</p><p><b>contact</b>: ANS: <a href="https://esante.gouv.fr">https://esante.gouv.fr</a></p><p><b>description</b>: Recherche des offres caractérisées par l’activité opérationnelle « 227 - Pédopsychiatrie infanto-juvénile »</p><p><b>jurisdiction</b>: FRANCE <span style="background: LightGoldenRodYellow; margin: 4px; border: 1px solid khaki"> (<a href="http://terminology.hl7.org/5.3.0/CodeSystem-ISO3166Part1.html">ISO 3166-1 Codes for the representation of names of countries and their subdivisions — Part 1: Country code</a>#FR)</span></p><p><b>purpose</b>: Un consommateur cherche les offres ayant une activité opérationnelle qui correspond à l’unique valeur recherchée par le consommateur.</p><blockquote><p><b>metadata</b></p><h3>Links</h3><table class="grid"><tr><td style="display: none">-</td><td><b>Url</b></td></tr><tr><td style="display: none">*</td><td><a href="https://ansforge.github.io/IG-fhir-repertoire-offre-ressources-sante/ig/narratif-scenario-retour-platine/specifications_techniques_3.html#sc%C3%A9nario-1-recherche-sur-un-crit%C3%A8re-en-saisissant-une-valeur">https://ansforge.github.io/IG-fhir-repertoire-offre-ressources-sante/ig/narratif-scenario-retour-platine/specifications_techniques_3.html#sc%C3%A9nario-1-recherche-sur-un-crit%C3%A8re-en-saisissant-une-valeur</a></td></tr></table><h3>Capabilities</h3><table class="grid"><tr><td style="display: none">-</td><td><b>Required</b></td><td><b>Validated</b></td><td><b>Description</b></td><td><b>Link</b></td><td><b>Capabilities</b></td></tr><tr><td style="display: none">*</td><td>true</td><td>false</td><td>Search Operation</td><td><a href="http://hl7.org/fhir/R4/http.html#search">http://hl7.org/fhir/R4/http.html#search</a></td><td><code>CapabilityStatement/ror-consommateur</code></td></tr></table></blockquote><h3>Fixtures</h3><table class="grid"><tr><td style="display: none">-</td><td><b>Autocreate</b></td><td><b>Autodelete</b></td></tr><tr><td style="display: none">*</td><td>false</td><td>false</td></tr></table><p><b>profile</b>: <a href="https://simplifier.net/resolve?scope=ANS.annuaire.fhir.r4@0.2.0&amp;canonical=http://fhir.org/packages/ans.annuaire.fhir.r4/StructureDefinition/Bundle">StructureDefinition/Bundle</a></p><blockquote><p><b>variable</b></p><p><b>name</b>: HealthcareServiceSpecialty</p><p><b>description</b>: critère de recherche sur l’activité opérationnelle</p><p><b>hint</b>: [Specialty]</p></blockquote><blockquote><p><b>variable</b></p><p><b>name</b>: OffreSearchBundleTotal</p><p><b>description</b>: Nombre d'offres retournées par le searchset Bundle.total</p><p><b>expression</b>: Bundle.total.toInteger()</p></blockquote><blockquote><p><b>test</b></p><blockquote><p><b>id</b></p>spec3-scenario1</blockquote><p><b>name</b>: Recherche sur un critère en saisissant une valeur</p><p><b>description</b>: Search for Patient resources using the user defined dynamic variables ${PatientSearchFamilyName} and ${PatientSearchGivenName} and validate response.</p><blockquote><p><b>action</b></p><h3>Operations</h3><table class="grid"><tr><td style="display: none">-</td><td><b>Type</b></td><td><b>Resource</b></td><td><b>Description</b></td><td><b>Accept</b></td><td><b>EncodeRequestUrl</b></td><td><b>Params</b></td></tr><tr><td style="display: none">*</td><td>Search (Details: http://terminology.hl7.org/CodeSystem/testscript-operation-codes code search = 'Search', stated as 'null')</td><td>HealthcareService</td><td>Recherche des offres caractérisées par l’activité opérationnelle « 227 - Pédopsychiatrie infanto-juvénile ».</td><td>json</td><td>true</td><td>?specialty=https://mos.esante.gouv.fr/NOS/TRE_R211-ActiviteOperationnelle/FHIR/TRE-R211-ActiviteOperationnelle|227&amp;_include=HealthcareService:organization&amp;_include:iterate=Organization:partof&amp;_include=HealthcareService:location&amp;_revinclude=PractitionerRole:service&amp;_include=PractitionerRole:practitioner</td></tr></table></blockquote><blockquote><p><b>action</b></p><h3>Asserts</h3><table class="grid"><tr><td style="display: none">-</td><td><b>Description</b></td><td><b>Response</b></td><td><b>WarningOnly</b></td></tr><tr><td style="display: none">*</td><td>Confirm that the returned HTTP status is 200(OK).</td><td>okay</td><td>false</td></tr></table></blockquote><blockquote><p><b>action</b></p><h3>Asserts</h3><table class="grid"><tr><td style="display: none">-</td><td><b>Description</b></td><td><b>ContentType</b></td><td><b>WarningOnly</b></td></tr><tr><td style="display: none">*</td><td>Confirm that the returned format is JSON.</td><td>json</td><td>false</td></tr></table></blockquote><blockquote><p><b>action</b></p><h3>Asserts</h3><table class="grid"><tr><td style="display: none">-</td><td><b>Description</b></td><td><b>Resource</b></td><td><b>WarningOnly</b></td></tr><tr><td style="display: none">*</td><td>Confirm that the returned resource type is Bundle.</td><td>Bundle</td><td>false</td></tr></table></blockquote><blockquote><p><b>action</b></p><h3>Asserts</h3><table class="grid"><tr><td style="display: none">-</td><td><b>Description</b></td><td><b>ValidateProfileId</b></td><td><b>WarningOnly</b></td></tr><tr><td style="display: none">*</td><td>Confirm that the returned Bundle conforms to the base FHIR specification.</td><td>bundle-profile</td><td>false</td></tr></table></blockquote><blockquote><p><b>action</b></p><h3>Asserts</h3><table class="grid"><tr><td style="display: none">-</td><td><b>Description</b></td><td><b>Operator</b></td><td><b>Path</b></td><td><b>Value</b></td><td><b>WarningOnly</b></td></tr><tr><td style="display: none">*</td><td>Confirm that the returned Bundle type equals 'searchset'.</td><td>equals</td><td>fhir:Bundle/fhir:type/@value</td><td>searchset</td><td>false</td></tr></table></blockquote><blockquote><p><b>action</b></p><h3>Asserts</h3><table class="grid"><tr><td style="display: none">-</td><td><b>Description</b></td><td><b>Expression</b></td><td><b>WarningOnly</b></td></tr><tr><td style="display: none">*</td><td>Confirm that the returned Bundle total is greater than or equal to the number of returned entries.</td><td>Bundle.total.toInteger() &gt;= entry.count()</td><td>false</td></tr></table></blockquote></blockquote></div>
  </text>
  <url value="https://interop.esante.gouv.fr/ig/fhir/ror/StructureDefinition/ror-testscript-spec3-scenario1"/>
  <version value="0.2.0"/>
  <name value="Recherche d'offre sur critères principaux : Scenario 1"/>
  <title value="Recherche sur un critère en saisissant une valeur"/>
  <status value="draft"/>
  <experimental value="true"/>
  <date value="2024-01-13"/>
  <publisher value="ANS"/>
  <contact>
    <name value="ANS"/>
    <telecom>
      <system value="url"/>
      <value value="https://esante.gouv.fr"/>
    </telecom>
  </contact>
  <description value="Recherche des offres caractérisées par l’activité opérationnelle « 227 - Pédopsychiatrie infanto-juvénile »"/>
  <jurisdiction>
    <coding>
      <system value="urn:iso:std:iso:3166"/>
      <code value="FR"/>
      <display value="FRANCE"/>
    </coding>
  </jurisdiction>
  <purpose value="Un consommateur cherche les offres ayant une activité opérationnelle qui correspond à l’unique valeur recherchée par le consommateur."/>
  <metadata>
    <link>
      <url value="https://ansforge.github.io/IG-fhir-repertoire-offre-ressources-sante/ig/narratif-scenario-retour-platine/specifications_techniques_3.html#sc%C3%A9nario-1-recherche-sur-un-crit%C3%A8re-en-saisissant-une-valeur"/>
    </link>
    <capability>
      <required value="true"/>
      <validated value="false"/>
      <description value="Search Operation"/>
      <link value="http://hl7.org/fhir/R4/http.html#search"/>
      <capabilities value="CapabilityStatement/ror-consommateur"/>
    </capability>
  </metadata>
  <fixture>
    <autocreate value="false"/>
    <autodelete value="false"/>
  </fixture>
  <profile id="bundle-profile">
    <reference value="StructureDefinition/Bundle"/>
  </profile>
  <variable>
    <name value="HealthcareServiceSpecialty"/>
    <description value="critère de recherche sur l’activité opérationnelle"/>
    <hint value="[Specialty]"/>
  </variable>
  <variable>
    <name value="OffreSearchBundleTotal"/>
    <description value="Nombre d'offres retournées par le searchset Bundle.total"/>
    <expression value="Bundle.total.toInteger()"/>
  </variable>
  <test id="spec3-scenario1">
    <name value="Recherche sur un critère en saisissant une valeur"/>
    <description value="Search for Patient resources using the user defined dynamic variables ${PatientSearchFamilyName} and ${PatientSearchGivenName} and validate response."/>
    <action>
      <operation>
        <type>
          <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
          <code value="search"/>
        </type>
        <resource value="HealthcareService"/>
        <description value="Recherche des offres caractérisées par l’activité opérationnelle « 227 - Pédopsychiatrie infanto-juvénile »."/>
        <accept value="json"/>
        <encodeRequestUrl value="true"/>
        <params value="?specialty=https://mos.esante.gouv.fr/NOS/TRE_R211-ActiviteOperationnelle/FHIR/TRE-R211-ActiviteOperationnelle|227&amp;_include=HealthcareService:organization&amp;_include:iterate=Organization:partof&amp;_include=HealthcareService:location&amp;_revinclude=PractitionerRole:service&amp;_include=PractitionerRole:practitioner"/>
      </operation>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned HTTP status is 200(OK)."/>
        <response value="okay"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned format is JSON."/>
        <contentType value="json"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned resource type is Bundle."/>
        <resource value="Bundle"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned Bundle conforms to the base FHIR specification."/>
        <validateProfileId value="bundle-profile"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned Bundle type equals 'searchset'."/>
        <operator value="equals"/>
        <path value="fhir:Bundle/fhir:type/@value"/>
        <value value="searchset"/>
        <warningOnly value="false"/>
      </assert>
    </action>
    <action>
      <assert>
        <description value="Confirm that the returned Bundle total is greater than or equal to the number of returned entries."/>
        <expression value="Bundle.total.toInteger() &gt;= entry.count()"/>
        <warningOnly value="false"/>
      </assert>
    </action>
  </test>
</TestScript>